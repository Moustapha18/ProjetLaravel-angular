<div class="relative">
  <div class="absolute top-2 right-2 text-xs px-2 py-1 rounded bg-amber-100"
       *ngIf="product?.percent_off || product?.promotion?.percent_off || product?.promo?.percent_off">
    -{{ product?.percent_off || product?.promotion?.percent_off || product?.promo?.percent_off }}%
  </div>

  <div class="mt-2">
    <ng-container *ngIf="product as p">
      <ng-container *ngIf="(p.percent_off || p?.promotion?.percent_off || p?.promo?.percent_off); else normalPrice">
        <div class="text-gray-400 line-through">
          {{ (p.price_cents || 0) / 100 | currency:'XOF' }}
        </div>
        <div class="text-emerald-700 font-semibold">
          {{ (discounted(p) / 100) | currency:'XOF' }}
        </div>
      </ng-container>
      <ng-template #normalPrice>
        <div class="text-gray-800 font-semibold">
          {{ ((p.price_cents || 0) / 100) | currency:'XOF' }}
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>
<div class="mt-4">
  <ng-container *ngIf="product as p">
    <div class="font-semibold text-lg mb-2">{{ p.name }}</div>
    <div class="mb-2 text-sm text-gray-600">Catégorie: {{ p.category?.name || '—' }}</div>
    <div class="mb-4 text-sm text-gray-600">Stock: {{ p.stock ?? '—' }}</div>
    <div class="mb-4 text-sm text-gray-600">Description: {{ p.description || '—' }}</div>
    <button class="px-4 py-2 bg-blue-600 text-white rounded" (click)="addToCart()" [disabled]="addingToCart()">
      {{ addingToCart() ? 'Ajout au panier…' : 'Ajouter au panier' }}
    </button>
    <div class="text-xs text-red-600 mt-2" *ngIf="errorMessage">{{ errorMessage }}</div>
    <div class="text-xs text-green-600 mt-2" *ngIf="successMessage">{{ successMessage }}</div>
  </ng-container>